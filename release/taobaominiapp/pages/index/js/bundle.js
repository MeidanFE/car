var window = $global.window;
var document = window.document;
var XMLHttpRequest = window.XMLHttpRequest;
var Laya = window.Laya;
var Laya3D = window.Laya3D;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}!function(){var e=function(e){function AutoMove(){var e;return _classCallCheck(this,AutoMove),(e=_possibleConstructorReturn(this,_getPrototypeOf(AutoMove).call(this))).moveSpeed=20,e}return _inherits(AutoMove,Laya.Script),_createClass(AutoMove,[{key:"onAwake",value:function(){Laya.timer.frameLoop(1,this,this.frameLoop)}},{key:"frameLoop",value:function(){var e=this.owner;e.y+=this.moveSpeed,e.y>1920&&(e.y=-1920)}}]),AutoMove}(),t=function(e){function StartPanel(){var e;return _classCallCheck(this,StartPanel),(e=_possibleConstructorReturn(this,_getPrototypeOf(StartPanel).call(this))).btn_Play=null,e.btn_AudioOn=null,e.btn_AudioOff=null,e}return _inherits(StartPanel,Laya.Script),_createClass(StartPanel,[{key:"onAwake",value:function(){this.btn_Play.on(Laya.Event.CLICK,this,this.btnPlayClick),this.btn_AudioOn.on(Laya.Event.CLICK,this,this.btnAudioOnClick),this.btn_AudioOff.on(Laya.Event.CLICK,this,this.btnAudioOffClick),Laya.stage.on("Mute",this,this.IsMute)}},{key:"btnPlayClick",value:function(){this.owner.visible=!1,Laya.stage.event("StartGame"),Laya.SoundManager.playSound("Sounds/ButtonClick.ogg",1)}},{key:"btnAudioOnClick",value:function(){this.btn_AudioOff.visible=!0,this.btn_AudioOn.visible=!1,Laya.SoundManager.playSound("Sounds/ButtonClick.ogg",1),Laya.SoundManager.muted=!0,Laya.stage.event("Mute",!0)}},{key:"btnAudioOffClick",value:function(){this.btn_AudioOff.visible=!1,this.btn_AudioOn.visible=!0,Laya.SoundManager.playSound("Sounds/ButtonClick.ogg",1),Laya.SoundManager.muted=!1,Laya.stage.event("Mute",!1)}},{key:"HomeButtonClick",value:function(){this.owner.visible=!0}},{key:"IsMute",value:function(e){e?(this.owner.getChildByName("btn_AudioOn").visible=!1,this.owner.getChildByName("btn_AudioOff").visible=!0):(this.owner.getChildByName("btn_AudioOn").visible=!0,this.owner.getChildByName("btn_AudioOff").visible=!1)}}]),StartPanel}(),a=function(e){function Car(){var e;return _classCallCheck(this,Car),(e=_possibleConstructorReturn(this,_getPrototypeOf(Car).call(this))).speed=15,e}return _inherits(Car,Laya.Script),_createClass(Car,[{key:"Init",value:function(e){this.sign=e}},{key:"onAwake",value:function(){Laya.timer.frameLoop(1,this,this.frameLoop)}},{key:"frameLoop",value:function(){this.owner.y+=this.speed}},{key:"onTriggerExit",value:function(e){"BottomCollider"==e.label&&(this.owner.removeSelf(),this.recover())}},{key:"recover",value:function(){Laya.Pool.recover(this.sign,this.owner)}}]),Car}(),n=function(e){function Player(){var e;return _classCallCheck(this,Player),(e=_possibleConstructorReturn(this,_getPrototypeOf(Player).call(this))).playerMinX=200,e.playerMaxX=880,e.isStartGame=!1,e.initXArr=[260,450,640,820],e}return _inherits(Player,Laya.Script),_createClass(Player,[{key:"onAwake",value:function(){Laya.SoundManager.playMusic("Sounds/FutureWorld_Dark_Loop_03.ogg",0),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.mouseDown),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.mouseUp),this.rig=this.owner.getComponent(Laya.RigidBody),Laya.stage.on("StartGame",this,function(){this.isStartGame=!0}),Laya.stage.on("Pause",this,function(){this.isStartGame=!1}),this.Reset()}},{key:"mouseDown",value:function(){if(this.isStartGame&&!(Laya.stage.mouseY<=500)){var e=0;e=Laya.stage.mouseX<Laya.stage.width/2?-1:1,this.rig.linearVelocity={x:6*e,y:0},Laya.Tween.to(this.owner,{rotation:25*e},100)}}},{key:"mouseUp",value:function(){this.rig.linearVelocity={x:0,y:0},Laya.Tween.to(this.owner,{rotation:0},100)}},{key:"onUpdate",value:function(){var e=this.owner;e.x<this.playerMinX&&(e.x=this.playerMinX),e.x>this.playerMaxX&&(e.x=this.playerMaxX)}},{key:"onTriggerEnter",value:function(e){"Car"==e.label&&(Laya.SoundManager.playSound("Sounds/CarCrash.ogg",1),this.isStartGame=!1,Laya.stage.event("GameOver")),"Coin"==e.label&&(Laya.SoundManager.playSound("Sounds/Bonus.ogg",1),e.owner.removeSelf(),e.owner.getComponent(a).recover(),Laya.stage.event("AddScore",10))}},{key:"getRandom",value:function(e,t){var a=Math.random()*(t-e);return e+(a=Math.round(a))}},{key:"Reset",value:function(){var e=this.owner,t=this.getRandom(0,this.initXArr.length-1);e.pos(this.initXArr[t],1360)}}]),Player}(),o=function(e){function GameManager(){var e;return _classCallCheck(this,GameManager),(e=_possibleConstructorReturn(this,_getPrototypeOf(GameManager).call(this))).carPrefabArr=[],e.spawnCarArr=[],e.isStartGame=!1,e}return _inherits(GameManager,Laya.Script),_createClass(GameManager,[{key:"onAwake",value:function(){var e=this;Laya.stage.on("StartGame",this,function(){e.isStartGame=!0}),Laya.stage.on("GameOver",this,this.gameOver),this.loadCarPrefab()}},{key:"loadCarPrefab",value:function(){for(var e=["prefab/Car_01.json","prefab/Car_02.json","prefab/Car_03.json","prefab/Car_04.json","prefab/Car_05.json","prefab/Car_05.json","prefab/Coin.json"],t=[],a=0;a<e.length;a++)t.push({url:e[a],type:Laya.Loader.PREFAB});Laya.loader.load(t,Laya.Handler.create(this,function(){for(var t=0;t<e.length;t++)this.carPrefabArr.push(Laya.loader.getRes(e[t]));this.ranTime=this.getRandom(500,1e3),Laya.timer.loop(this.ranTime,this,function(){this.spawn(),this.ranTime=this.getRandom(500,1e3)})}))}},{key:"spawn",value:function(){if(this.isStartGame){var e=[260,450,640,820],t=e[this.getRandom(0,e.length-1)];this.typeIndex=this.getRandom(0,this.carPrefabArr.length-1);var n=Laya.Pool.getItemByCreateFun(this.typeIndex.toString(),function(){return this.carPrefabArr[this.typeIndex].create()},this);Laya.stage.getChildAt(0).getChildAt(0).addChild(n),this.spawnCarArr.push(n),n.pos(t,-300),n.getComponent(a).Init(this.typeIndex.toString())}}},{key:"gameOver",value:function(){this.isStartGame=!1;for(var e=0;e<this.spawnCarArr.length;e++){this.spawnCarArr[e].removeSelf()}}},{key:"getRandom",value:function(e,t){var a=Math.random()*(t-e);return e+(a=Math.round(a))}},{key:"HomeButtonClick",value:function(){this.gameOver()}},{key:"RestartButtonClick",value:function(){for(var e=0;e<this.spawnCarArr.length;e++){this.spawnCarArr[e].removeSelf()}}}]),GameManager}(),i=function(e){function GamePanel(){var e;return _classCallCheck(this,GamePanel),(e=_possibleConstructorReturn(this,_getPrototypeOf(GamePanel).call(this))).txt_Best=null,e.txt_Last=null,e.txt_Score=null,e.btn_Pause=null,e.score=0,e}return _inherits(GamePanel,Laya.Script),_createClass(GamePanel,[{key:"onAwake",value:function(){this.txt_Best=this.owner.getChildByName("txt_best"),this.txt_Last=this.owner.getChildByName("txt_last"),this.txt_Score=this.owner.getChildByName("txt_score"),this.btn_Pause=this.owner.getChildByName("btn_Pause"),this.btn_Pause.on(Laya.Event.CLICK,this,this.pauseBtnClick),Laya.loader.load("font.ttf",Laya.Handler.create(this,this.onFontLoad),null,Laya.Loader.TTF),this.owner.visible=!1,Laya.stage.on("StartGame",this,function(){this.owner.visible=!0,this.Init()}),Laya.timer.loop(300,this,this.AddScore),Laya.stage.on("AddScore",this,this.AddScore),Laya.stage.on("GameOver",this,function(){this.owner.visible=!1})}},{key:"Init",value:function(){this.txt_Last.text="Last:"+Laya.LocalStorage.getItem("LastScore"),this.txt_Best.text="Best:"+Laya.LocalStorage.getItem("BestScore"),this.txt_Score.text="0",this.score=0}},{key:"onFontLoad",value:function(e){console.log(e),this.txt_Best.font=e.fontName,this.txt_Last.font=e.fontName,this.txt_Score.font=e.fontName}},{key:"AddScore",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;0!=this.owner.visible&&(this.score+=e,this.txt_Score.text=this.score.toString())}},{key:"pauseBtnClick",value:function(){Laya.timer.pause(),Laya.stage.event("Pause"),this.owner.visible=!1,Laya.SoundManager.playSound("Sounds/ButtonClick.ogg",1)}}]),GamePanel}(),r=function(e){function PausePanel(){return _classCallCheck(this,PausePanel),_possibleConstructorReturn(this,_getPrototypeOf(PausePanel).call(this))}return _inherits(PausePanel,Laya.Script),_createClass(PausePanel,[{key:"onAwake",value:function(){Laya.loader.load("font.ttf",Laya.Handler.create(this,this.onFontLoad),null,Laya.Loader.TTF),this.owner.getChildByName("btn_Home").on(Laya.Event.CLICK,this,function(){Laya.timer.resume(),this.owner.visible=!1,this.owner.parent.getChildByName("StartPanel").getComponent(t).HomeButtonClick(),this.owner.parent.getComponent(o).HomeButtonClick()}),this.owner.getChildByName("btn_Close").on(Laya.Event.CLICK,this,function(){Laya.timer.resume(),Laya.SoundManager.playSound("Sounds/ButtonClick.ogg",1),this.owner.visible=!1,this.owner.parent.getChildByName("GamePanel").visible=!0}),this.owner.getChildByName("btn_Restart").on(Laya.Event.CLICK,this,function(){Laya.timer.resume(),Laya.SoundManager.playSound("Sounds/ButtonClick.ogg",1),this.owner.visible=!1,this.owner.parent.getComponent(o).RestartButtonClick(),Laya.stage.event("StartGame"),this.owner.parent.getChildByName("player").getComponent(n).Reset()}),this.owner.getChildByName("btn_AudioOn").on(Laya.Event.CLICK,this,function(){this.owner.getChildByName("btn_AudioOn").visible=!1,this.owner.getChildByName("btn_AudioOff").visible=!0,Laya.SoundManager.playSound("Sounds/ButtonClick.ogg",1),Laya.SoundManager.muted=!0,Laya.stage.event("Mute",!0)}),this.owner.getChildByName("btn_AudioOff").on(Laya.Event.CLICK,this,function(){this.owner.getChildByName("btn_AudioOn").visible=!0,this.owner.getChildByName("btn_AudioOff").visible=!1,Laya.SoundManager.playSound("Sounds/ButtonClick.ogg",1),Laya.SoundManager.muted=!1,Laya.stage.event("Mute",!1)}),Laya.stage.on("Pause",this,function(){Laya.SoundManager.playSound("Sounds/ButtonClick.ogg",1),this.owner.visible=!0}),Laya.stage.on("Mute",this,this.IsMute)}},{key:"IsMute",value:function(e){e?(this.owner.getChildByName("btn_AudioOn").visible=!1,this.owner.getChildByName("btn_AudioOff").visible=!0):(this.owner.getChildByName("btn_AudioOn").visible=!0,this.owner.getChildByName("btn_AudioOff").visible=!1)}},{key:"onFontLoad",value:function(e){this.owner.getChildByName("txt_Pause").font=e.fontName}}]),PausePanel}(),s=function(e){function GameOverPanel(){var e;return _classCallCheck(this,GameOverPanel),(e=_possibleConstructorReturn(this,_getPrototypeOf(GameOverPanel).call(this))).txt_Score=null,e.txt_HighScore=null,e}return _inherits(GameOverPanel,Laya.Script),_createClass(GameOverPanel,[{key:"onAwake",value:function(){var e=this;this.txt_Score=this.owner.getChildByName("txt_GameOverScore"),this.txt_HighScore=this.owner.getChildByName("txt_HighScore"),Laya.loader.load("font.ttf",Laya.Handler.create(this,function(t){e.owner.getChildByName("txt_GameOver").font=t.fontName,e.txt_Score.font=t.fontName,e.txt_HighScore.font=t.fontName}),null,Laya.Loader.TTF),this.owner.getChildByName("btn_Home").on(Laya.Event.CLICK,this,function(){Laya.timer.resume(),Laya.SoundManager.playSound("Sounds/ButtonClick.ogg",1);var e=this.owner;e.visible=!1,e.parent.getChildByName("StartPanel").getComponent(t).HomeButtonClick(),e.parent.getComponent(o).HomeButtonClick(),e.parent.getChildByName("player").getComponent(n).Reset()}),this.owner.getChildByName("btn_Reset").on(Laya.Event.CLICK,this,function(){Laya.SoundManager.playSound("Sounds/ButtonClick.ogg",1),Laya.timer.resume(),this.owner.visible=!1,this.owner.parent.getComponent(o).RestartButtonClick(),Laya.stage.event("StartGame"),this.owner.parent.getChildByName("player").getComponent(n).Reset()}),Laya.stage.on("GameOver",this,this.gameOver)}},{key:"gameOver",value:function(){this.owner.visible=!0;var e=this.owner.parent.getChildByName("GamePanel").getComponent(i).score;this.txt_Score.text="Score:"+e;var t=Number(Laya.LocalStorage.getItem("BestScore"));e>t?(Laya.LocalStorage.setItem("BestScore",e),this.txt_HighScore.text="HightScore:"+e):this.txt_HighScore.text="HightScore:"+t,Laya.LocalStorage.setItem("LastScore",e)}}]),GameOverPanel}(),l=function(){function GameConfig(){_classCallCheck(this,GameConfig)}return _createClass(GameConfig,null,[{key:"init",value:function(){var l=Laya.ClassUtils.regClass;l("AutoMove.ts",e),l("StartPanel.ts",t),l("Player.ts",n),l("GameManager.ts",o),l("GamePanel.ts",i),l("PausePanel.ts",r),l("GameOverPanel.ts",s),l("Car.ts",a)}}]),GameConfig}();l.width=1080,l.height=1920,l.scaleMode="showall",l.screenMode="none",l.alignV="top",l.alignH="left",l.startScene="Main.scene",l.sceneRoot="",l.debug=!1,l.stat=!1,l.physicsDebug=!1,l.exportSceneToJson=!0,l.init(),new(function(){function Main(){_classCallCheck(this,Main),window.Laya3D?Laya3D.init(l.width,l.height):Laya.init(l.width,l.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=l.scaleMode,Laya.stage.screenMode=l.screenMode,Laya.stage.alignV=l.alignV,Laya.stage.alignH=l.alignH,Laya.URL.exportSceneToJson=l.exportSceneToJson,(l.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),l.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),l.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}return _createClass(Main,[{key:"onVersionLoaded",value:function(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}},{key:"onConfigLoaded",value:function(){l.startScene&&Laya.Scene.open(l.startScene)}}]),Main}())}();